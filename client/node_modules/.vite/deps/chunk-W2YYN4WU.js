import {
  BackButton,
  FormField,
  HeadlessConnectUI,
  HelperLink,
  Img,
  ModalDescription,
  ModalTitle,
  WalletSelection,
  defaultWallets,
  require_lib,
  useIsHeadlessWallet
} from "./chunk-OZUD3FIK.js";
import {
  Button,
  ChevronDownIcon,
  ErrorMessage,
  ExclamationTriangleIcon,
  Flex,
  Label,
  Spacer,
  Spinner,
  fontSize,
  iconSize,
  newStyled,
  spacing,
  useChain,
  useChainId,
  useConnect,
  useConnectionStatus,
  useDisconnect,
  useSupportedChains,
  useSwitchChain,
  useWallet
} from "./chunk-FZ33VQ4Q.js";
import {
  SafeWallet
} from "./chunk-RDOPESVP.js";
import {
  SafeSupportedChainsSet
} from "./chunk-RM25UG3Z.js";
import {
  init_es
} from "./chunk-SXM3NUOY.js";
import {
  walletIds
} from "./chunk-OLCE3NRE.js";
import {
  init_lib7 as init_lib,
  utils_exports
} from "./chunk-T4GQYX7O.js";
import {
  require_jsx_runtime
} from "./chunk-UMZUPRA3.js";
import {
  require_react
} from "./chunk-TUKKSTYG.js";
import {
  init_shim
} from "./chunk-ZGMFR26H.js";
import {
  __toESM
} from "./chunk-IKJM6GHQ.js";

// node_modules/@thirdweb-dev/react/dist/safeWallet-08c1af58.browser.esm.js
init_shim();
var import_react = __toESM(require_react());
var import_jsx_runtime = __toESM(require_jsx_runtime());
init_lib();
init_es();
var import_react_qr_code = __toESM(require_lib());
function Steps(_ref) {
  let {
    step
  } = _ref;
  return (0, import_jsx_runtime.jsxs)(StepContainer, {
    children: [(0, import_jsx_runtime.jsx)(Circle, {
      "data-active": true
    }), (0, import_jsx_runtime.jsx)(Line, {
      "data-active": step === 2
    }), (0, import_jsx_runtime.jsx)(Circle, {
      "data-active": step === 2
    })]
  });
}
var StepContainer = newStyled.div`
  display: flex;
  align-items: center;
  width: 130px;
  padding: ${spacing.xs};
`;
var Circle = newStyled.div`
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background-color: ${(p) => p.theme.bg.highlighted};
  box-shadow: 0 0 0 3px ${(p) => p.theme.bg.base},
    0 0 0 5px ${(p) => p.theme.bg.highlighted};

  &[data-active="true"] {
    background-color: ${(p) => p.theme.link.primary};
    box-shadow: 0 0 0 3px ${(p) => p.theme.bg.base},
      0 0 0 5px ${(p) => p.theme.link.primary};

    position: relative;
    z-index: 2;
  }
`;
var Line = newStyled.div`
  flex-grow: 1;
  height: 4px;
  background-color: ${(p) => p.theme.bg.highlighted};
  &[data-active="true"] {
    background-color: ${(p) => p.theme.link.primary};
  }
`;
var SelectpersonalWallet = (props) => {
  const guestWallet = props.personalWallets.find((w) => w.id === walletIds.localWallet);
  const personalWallets = props.personalWallets.filter((w) => w.id !== walletIds.localWallet);
  return (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, {
    children: [props.renderBackButton && (0, import_jsx_runtime.jsx)(BackButton, {
      onClick: props.onBack
    }), (0, import_jsx_runtime.jsx)(IconContainer, {
      children: (0, import_jsx_runtime.jsx)(Img, {
        src: props.safeWallet.meta.iconURL,
        width: iconSize.xl,
        height: iconSize.xl
      })
    }), (0, import_jsx_runtime.jsx)(Spacer, {
      y: "lg"
    }), (0, import_jsx_runtime.jsx)(ModalTitle, {
      children: "Link Personal Wallet"
    }), (0, import_jsx_runtime.jsx)(Spacer, {
      y: "sm"
    }), (0, import_jsx_runtime.jsx)(ModalDescription, {
      children: "Select a personal wallet to connect to your Safe"
    }), (0, import_jsx_runtime.jsx)(Spacer, {
      y: "xl"
    }), (0, import_jsx_runtime.jsx)(Steps, {
      step: 1
    }), (0, import_jsx_runtime.jsx)(Spacer, {
      y: "lg"
    }), (0, import_jsx_runtime.jsx)(WalletSelection, {
      walletConfigs: personalWallets,
      selectWallet: props.selectWallet
    }), (0, import_jsx_runtime.jsx)(Spacer, {
      y: "xl"
    }), guestWallet ? (0, import_jsx_runtime.jsx)(Flex, {
      justifyContent: "center",
      children: (0, import_jsx_runtime.jsx)(Button, {
        variant: "link",
        onClick: () => {
          props.selectWallet(guestWallet);
        },
        "data-test": "continue-as-guest-button",
        children: "Continue as guest"
      })
    }) : (0, import_jsx_runtime.jsx)(HelperLink, {
      target: "_blank",
      href: "https://docs.safe.global/learn/what-is-a-smart-contract-account",
      style: {
        textAlign: "center"
      },
      children: "What is a Safe?"
    })]
  });
};
var IconContainer = newStyled.div`
  margin-top: ${spacing.lg};
`;
var gnosisAddressPrefixToChainId = {
  eth: 1,
  matic: 137,
  avax: 43114,
  bnb: 56,
  oeth: 10,
  gor: 5
};
var SelectAccount = (props) => {
  const activeWallet = useWallet();
  const connect = useConnect();
  const activeChain = useChain();
  const connectedChainId = useChainId();
  const [safeAddress, setSafeAddress] = (0, import_react.useState)("");
  const [safeChainId, setSafeChainId] = (0, import_react.useState)(-1);
  const [safeConnectError, setSafeConnectError] = (0, import_react.useState)(false);
  const [switchError, setSwitchError] = (0, import_react.useState)(false);
  const [switchingNetwork, setSwitchingNetwork] = (0, import_react.useState)(false);
  const connectionStatus = useConnectionStatus();
  const requiresConfirmation = !useIsHeadlessWallet();
  const chains = useSupportedChains();
  const supportedChains = chains.filter((c) => SafeSupportedChainsSet.has(c.chainId));
  const selectedSafeChain = supportedChains.find((c) => c.chainId === safeChainId);
  const testnets = supportedChains.filter((c) => c.testnet);
  const mainnets = supportedChains.filter((c) => !c.testnet);
  const useOptGroup = mainnets.length > 0 && testnets.length > 0;
  const handleSubmit = async () => {
    if (!selectedSafeChain || !activeWallet || !activeChain) {
      return;
    }
    setSafeConnectError(false);
    try {
      await connect(props.safeWalletConfig, {
        chain: selectedSafeChain,
        personalWallet: activeWallet,
        safeAddress
      });
      props.onConnect();
    } catch (e) {
      console.error(e);
      setSafeConnectError(true);
    }
  };
  const mismatch = safeChainId !== -1 && connectedChainId !== safeChainId;
  const isValidAddress = utils_exports.isAddress(safeAddress);
  const disableNetworkSelection = supportedChains.length === 1;
  const switchChain = useSwitchChain();
  return (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, {
    children: [(0, import_jsx_runtime.jsx)(BackButton, {
      onClick: props.onBack
    }), (0, import_jsx_runtime.jsx)(Spacer, {
      y: "md"
    }), (0, import_jsx_runtime.jsx)(Img, {
      src: props.safeWalletConfig.meta.iconURL,
      width: iconSize.xl,
      height: iconSize.xl
    }), (0, import_jsx_runtime.jsx)(Spacer, {
      y: "lg"
    }), (0, import_jsx_runtime.jsx)(ModalTitle, {
      children: "Enter your Safe Address & Network "
    }), (0, import_jsx_runtime.jsx)(Spacer, {
      y: "md"
    }), (0, import_jsx_runtime.jsxs)(ModalDescription, {
      children: ["You can find your safe address in", " ", (0, import_jsx_runtime.jsx)(HelperLink, {
        target: "_blank",
        href: "https://app.safe.global/home",
        style: {
          display: "inline"
        },
        children: "Safe Dashboard"
      })]
    }), (0, import_jsx_runtime.jsx)(Spacer, {
      y: "lg"
    }), (0, import_jsx_runtime.jsx)(Steps, {
      step: 2
    }), (0, import_jsx_runtime.jsx)(Spacer, {
      y: "xl"
    }), (0, import_jsx_runtime.jsxs)("form", {
      onSubmit: (e) => {
        e.preventDefault();
        handleSubmit();
      },
      children: [(0, import_jsx_runtime.jsx)(FormField, {
        name: "safeAddress",
        id: "safeAddress",
        errorMessage: safeAddress && !isValidAddress ? "Invalid Safe Address" : void 0,
        autocomplete: "on",
        onChange: (value) => {
          setSafeConnectError(false);
          if (value.length > 4) {
            const prefix = value.split(":")[0];
            if (prefix && prefix in gnosisAddressPrefixToChainId) {
              setSafeChainId(gnosisAddressPrefixToChainId[prefix]);
              setSafeAddress(value.slice(prefix.length + 1));
            } else {
              setSafeAddress(value);
            }
          } else {
            setSafeAddress(value);
          }
        },
        label: "Safe Address",
        type: "text",
        value: safeAddress,
        required: true,
        placeholder: "0x123..."
      }), (0, import_jsx_runtime.jsx)(Spacer, {
        y: "lg"
      }), (0, import_jsx_runtime.jsx)(Label, {
        htmlFor: "safeNetwork",
        children: "Safe Network"
      }), (0, import_jsx_runtime.jsx)(Spacer, {
        y: "xs"
      }), (0, import_jsx_runtime.jsxs)("div", {
        style: {
          position: "relative"
        },
        children: [(0, import_jsx_runtime.jsxs)(NetworkSelect, {
          "data-error": supportedChains.length === 0,
          required: true,
          name: "safeNetwork",
          id: "safeNetwork",
          value: safeChainId,
          disabled: disableNetworkSelection,
          placeholder: "Select Network your safe is deployed to",
          onChange: (e) => {
            setSafeConnectError(false);
            setSwitchError(false);
            setSafeChainId(Number(e.target.value));
          },
          children: [!disableNetworkSelection && (0, import_jsx_runtime.jsx)("option", {
            value: "",
            hidden: true,
            children: "Select network your safe is deployed on"
          }), useOptGroup ? (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, {
            children: [(0, import_jsx_runtime.jsx)("optgroup", {
              label: "Mainnets",
              children: mainnets.map((chain) => {
                return (0, import_jsx_runtime.jsx)("option", {
                  value: chain.chainId,
                  children: chain.name
                }, chain.chainId);
              })
            }), (0, import_jsx_runtime.jsx)("optgroup", {
              label: "Testnets",
              children: testnets.map((chain) => {
                return (0, import_jsx_runtime.jsx)("option", {
                  value: chain.chainId,
                  children: chain.name
                }, chain.chainId);
              })
            })]
          }) : supportedChains.map((chain) => {
            return (0, import_jsx_runtime.jsx)("option", {
              value: chain.chainId,
              children: chain.name
            }, chain.chainId);
          })]
        }), !disableNetworkSelection && (0, import_jsx_runtime.jsx)(StyledChevronDownIcon, {
          width: iconSize.sm,
          height: iconSize.sm,
          style: {
            position: "absolute",
            top: "50%",
            right: spacing.sm,
            transform: "translateY(-50%)",
            pointerEvents: "none"
          }
        })]
      }), supportedChains.length === 0 && (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, {
        children: [(0, import_jsx_runtime.jsx)(Spacer, {
          y: "sm"
        }), (0, import_jsx_runtime.jsxs)(ErrorMessage, {
          children: [" ", "Can not use Safe: No Safe supported chains are configured in App"]
        })]
      }), (0, import_jsx_runtime.jsx)(Spacer, {
        y: "sm"
      }), safeConnectError && (0, import_jsx_runtime.jsxs)(ErrorMessage, {
        style: {
          display: "flex",
          gap: spacing.sm,
          alignItems: "center",
          fontSize: fontSize.sm
        },
        children: [(0, import_jsx_runtime.jsx)(ExclamationTriangleIcon, {
          width: iconSize.sm,
          height: iconSize.sm
        }), (0, import_jsx_runtime.jsxs)("span", {
          children: ["Could not connect to Safe. ", (0, import_jsx_runtime.jsx)("br", {}), "Make sure safe address and network are correct."]
        })]
      }), switchError && (0, import_jsx_runtime.jsxs)(ErrorMessage, {
        style: {
          display: "flex",
          gap: spacing.sm,
          alignItems: "center",
          fontSize: fontSize.sm
        },
        children: [(0, import_jsx_runtime.jsx)(ExclamationTriangleIcon, {
          width: iconSize.sm,
          height: iconSize.sm
        }), (0, import_jsx_runtime.jsx)("span", {
          children: "Failed to switch network."
        })]
      }), (0, import_jsx_runtime.jsx)(Spacer, {
        y: "xl"
      }), (0, import_jsx_runtime.jsx)("div", {
        style: {
          display: "flex",
          justifyContent: "flex-end"
        },
        children: mismatch ? (0, import_jsx_runtime.jsxs)(Button, {
          type: "button",
          variant: "secondary",
          style: {
            display: "flex",
            alignItems: "center",
            gap: spacing.sm
          },
          onClick: async () => {
            if (!activeWallet) {
              throw new Error("No active wallet");
            }
            setSafeConnectError(false);
            setSwitchError(false);
            setSwitchingNetwork(true);
            try {
              await switchChain(safeChainId);
            } catch (e) {
              setSwitchError(true);
            } finally {
              setSwitchingNetwork(false);
            }
          },
          children: [" ", switchingNetwork ? "Switching" : "Switch Network", switchingNetwork && (0, import_jsx_runtime.jsx)(Spinner, {
            size: "sm",
            color: "primary"
          })]
        }) : (0, import_jsx_runtime.jsxs)(Button, {
          variant: "inverted",
          type: "submit",
          style: {
            display: "flex",
            alignItems: "center",
            gap: spacing.sm
          },
          children: [connectionStatus === "connecting" ? "Connecting" : "Connect to Safe", connectionStatus === "connecting" && (0, import_jsx_runtime.jsx)(Spinner, {
            size: "sm",
            color: "inverted"
          })]
        })
      }), switchingNetwork && requiresConfirmation && (0, import_jsx_runtime.jsx)(ConfirmMessage, {
        children: " Confirm in your wallet "
      })]
    })]
  });
};
var ConfirmMessage = newStyled.p`
  font-size: ${fontSize.sm};
  color: ${(p) => p.theme.link.primary};
  text-align: right;
`;
var NetworkSelect = newStyled.select`
  width: 100%;
  padding: ${spacing.sm};
  box-sizing: border-box;
  outline: none;
  border: none;
  border-radius: 6px;
  color: ${(p) => p.theme.text.neutral};
  background: transparent;
  font-size: ${fontSize.md};
  box-shadow: 0 0 0 1.5px ${(p) => p.theme.input.outline};
  appearance: none;

  &:focus {
    box-shadow: 0 0 0 2px ${(p) => p.theme.input.focusRing};
  }

  &:invalid {
    color: ${(p) => p.theme.text.secondary};
  }
  &[data-error="true"] {
    box-shadow: 0 0 0 1.5px ${(p) => p.theme.input.errorRing};
  }

  &[disabled] {
    opacity: 1;
    cursor: not-allowed;
  }
`;
var StyledChevronDownIcon = newStyled(ChevronDownIcon)`
  color: ${(p) => p.theme.icon.secondary};
`;
var safeWallet = (config) => {
  const personalWallets = (config == null ? void 0 : config.personalWallets) || defaultWallets;
  return {
    id: SafeWallet.id,
    meta: SafeWallet.meta,
    create: (options) => new SafeWallet({
      ...options
    }),
    connectUI(props) {
      return (0, import_jsx_runtime.jsx)(SafeConnectUI, {
        ...props,
        personalWallets
      });
    },
    isInstalled() {
      return false;
    },
    personalWallets
  };
};
var SafeConnectUI = (props) => {
  const activeWallet = useWallet();
  const [personalWalletConfig, setPersonalWalletConfig] = (0, import_react.useState)();
  const disconnect = useDisconnect();
  if (personalWalletConfig) {
    const _props = {
      close: () => {
        setPersonalWalletConfig(void 0);
        props.close(false);
      },
      goBack: () => {
        setPersonalWalletConfig(void 0);
      },
      isOpen: props.isOpen,
      open: props.open,
      theme: props.theme,
      walletConfig: personalWalletConfig,
      supportedWallets: props.personalWallets,
      selectionData: props.selectionData,
      setSelectionData: props.setSelectionData
    };
    if (personalWalletConfig.connectUI) {
      return (0, import_jsx_runtime.jsx)(personalWalletConfig.connectUI, {
        ..._props
      });
    }
    return (0, import_jsx_runtime.jsx)(HeadlessConnectUI, {
      ..._props
    });
  }
  if (!activeWallet) {
    return (0, import_jsx_runtime.jsx)(SelectpersonalWallet, {
      personalWallets: props.personalWallets,
      onBack: props.goBack,
      safeWallet: props.walletConfig,
      selectWallet: setPersonalWalletConfig,
      renderBackButton: props.supportedWallets.length > 1
    });
  }
  return (0, import_jsx_runtime.jsx)(SelectAccount, {
    onBack: disconnect,
    onConnect: props.close,
    safeWalletConfig: props.walletConfig
  });
};

export {
  safeWallet,
  SafeConnectUI
};
//# sourceMappingURL=chunk-W2YYN4WU.js.map
